{"ast":null,"code":"import { MatTableDataSource } from \"@angular/material/table\";\nimport { Subject, takeUntil } from \"rxjs\";\nimport { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { UserEditComponent } from \"./user/user-add-edit/user-edit.component\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../core/services/project.service\";\nimport * as i2 from \"../../../../facades/project-facade.service\";\nimport * as i3 from \"../../../../facades/users-facade.service\";\nimport * as i4 from \"../../../../core/services/users.service\";\nimport * as i5 from \"@angular/material/dialog\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/router\";\nimport * as i8 from \"@angular/material/form-field\";\nimport * as i9 from \"@angular/material/select\";\nimport * as i10 from \"@angular/material/core\";\nimport * as i11 from \"@angular/material/button\";\nimport * as i12 from \"@angular/material/table\";\nimport * as i13 from \"@angular/forms\";\nimport * as i14 from \"@angular/material/divider\";\nfunction ProjectUsersComponent_div_4_mat_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-option\", 19);\n    i0.ɵɵlistener(\"click\", function ProjectUsersComponent_div_4_mat_option_6_Template_mat_option_click_0_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r17.onSubmit());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const user_r16 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", user_r16.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", user_r16.firstName, \"\", user_r16.lastName, \" \");\n  }\n}\nfunction ProjectUsersComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"form\", 15)(2, \"mat-form-field\")(3, \"mat-label\");\n    i0.ɵɵtext(4, \"Chose User\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"mat-select\", 16);\n    i0.ɵɵtemplate(6, ProjectUsersComponent_div_4_mat_option_6_Template, 2, 3, \"mat-option\", 17);\n    i0.ɵɵpipe(7, \"async\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(8, \"mat-divider\");\n    i0.ɵɵelementStart(9, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ProjectUsersComponent_div_4_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.addNewUser());\n    });\n    i0.ɵɵtext(10, \"Add New User \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.userForm);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(7, 2, ctx_r0.users$));\n  }\n}\nfunction ProjectUsersComponent_th_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Id\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r21 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r21.id, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \"First Name\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r22 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r22.firstName, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Last Name\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r23 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r23.lastName, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \"Email\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r24 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r24.email, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \"Is Active\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r25 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r25.isActive, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"th\", 20);\n  }\n}\nconst _c0 = function (a1) {\n  return [\"/application/setting/users/edit/\", a1];\n};\nfunction ProjectUsersComponent_td_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r28 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\", 21)(1, \"button\", 22);\n    i0.ɵɵtext(2, \"Edit \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ProjectUsersComponent_td_23_Template_button_click_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r28);\n      const element_r26 = restoredCtx.$implicit;\n      const ctx_r27 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r27.removeUser(element_r26.id));\n    });\n    i0.ɵɵtext(4, \"Remove \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const element_r26 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(1, _c0, element_r26.id));\n  }\n}\nfunction ProjectUsersComponent_tr_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 24);\n  }\n}\nfunction ProjectUsersComponent_tr_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 25);\n  }\n}\nexport class ProjectUsersComponent {\n  get projectId() {\n    return this.projectFacade.getProject().id;\n  }\n  constructor(projectService, projectFacade, userFacade, userService, dialog) {\n    this.projectService = projectService;\n    this.projectFacade = projectFacade;\n    this.userFacade = userFacade;\n    this.userService = userService;\n    this.dialog = dialog;\n    this.displayedColumns = ['id', 'firstName', 'lastName', 'email', 'isActive', 'actions'];\n    this.dataSource = new MatTableDataSource();\n    this.sub$ = new Subject();\n    this.chooseUserActive = false;\n    this.users$ = this.userService.getUsersAll();\n    this.projectUsersIds = [];\n    this.userForm = new FormGroup({\n      userId: new FormControl(null, [Validators.required])\n    });\n  }\n  getCurrentProjectUsers() {\n    this.projectService.getProjectUsersId(this.projectId).pipe(takeUntil(this.sub$)).subscribe(users => {\n      this.projectUsersIds = users.map(user => user.id);\n      this.dataSource.data = users;\n    });\n  }\n  ngOnInit() {\n    this.getCurrentProjectUsers();\n  }\n  ngOnDestroy() {\n    this.sub$.next(null);\n    this.sub$.complete();\n  }\n  removeUser(id) {\n    const userIds = this.projectUsersIds.filter(userId => userId !== id);\n    this.projectService.addProjectUserData({\n      projectId: this.projectId,\n      userIds\n    }).pipe(takeUntil(this.sub$)).subscribe(() => {\n      this.getCurrentProjectUsers();\n    });\n  }\n  addUser() {\n    this.chooseUserActive = !this.chooseUserActive;\n  }\n  onSubmit() {\n    const userIds = [...this.projectUsersIds, this.userForm.value.userId];\n    this.createUser(userIds).subscribe(() => {\n      this.getCurrentProjectUsers();\n      this.addUser();\n    });\n  }\n  createUser(userIds) {\n    return this.projectService.addProjectUserData({\n      projectId: this.projectId,\n      userIds\n    }).pipe(takeUntil(this.sub$));\n  }\n  addNewUser() {\n    const dialog = this.dialog.open(UserEditComponent);\n    dialog.afterClosed().pipe(takeUntil(this.sub$)).subscribe(result => {\n      if (result) {\n        const userIds = [...this.projectUsersIds, result.id];\n        this.createUser(userIds).subscribe(() => {\n          this.getCurrentProjectUsers();\n          this.chooseUserActive = false;\n        });\n      }\n    });\n  }\n}\nProjectUsersComponent.ɵfac = function ProjectUsersComponent_Factory(t) {\n  return new (t || ProjectUsersComponent)(i0.ɵɵdirectiveInject(i1.ProjectService), i0.ɵɵdirectiveInject(i2.ProjectFacade), i0.ɵɵdirectiveInject(i3.UsersFacadeService), i0.ɵɵdirectiveInject(i4.UsersService), i0.ɵɵdirectiveInject(i5.MatDialog));\n};\nProjectUsersComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProjectUsersComponent,\n  selectors: [[\"app-project-users\"]],\n  decls: 26,\n  vars: 4,\n  consts: [[1, \"container\"], [1, \"choseUser\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [4, \"ngIf\"], [\"mat-table\", \"\", 1, \"mat-elevation-z8\", 3, \"dataSource\"], [\"matColumnDef\", \"id\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [\"matColumnDef\", \"firstName\"], [\"matColumnDef\", \"lastName\"], [\"matColumnDef\", \"email\"], [\"matColumnDef\", \"isActive\"], [\"matColumnDef\", \"actions\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [3, \"formGroup\"], [\"formControlName\", \"userId\"], [3, \"value\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 3, \"click\"], [3, \"value\", \"click\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"routerLink\"], [\"mat-raised-button\", \"\", \"color\", \"warn\", 3, \"click\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"]],\n  template: function ProjectUsersComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"button\", 2);\n      i0.ɵɵlistener(\"click\", function ProjectUsersComponent_Template_button_click_2_listener() {\n        return ctx.addUser();\n      });\n      i0.ɵɵtext(3, \"Choose User \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(4, ProjectUsersComponent_div_4_Template, 11, 4, \"div\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"table\", 4);\n      i0.ɵɵelementContainerStart(6, 5);\n      i0.ɵɵtemplate(7, ProjectUsersComponent_th_7_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(8, ProjectUsersComponent_td_8_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(9, 8);\n      i0.ɵɵtemplate(10, ProjectUsersComponent_th_10_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(11, ProjectUsersComponent_td_11_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(12, 9);\n      i0.ɵɵtemplate(13, ProjectUsersComponent_th_13_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(14, ProjectUsersComponent_td_14_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(15, 10);\n      i0.ɵɵtemplate(16, ProjectUsersComponent_th_16_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(17, ProjectUsersComponent_td_17_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(18, 11);\n      i0.ɵɵtemplate(19, ProjectUsersComponent_th_19_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(20, ProjectUsersComponent_td_20_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(21, 12);\n      i0.ɵɵtemplate(22, ProjectUsersComponent_th_22_Template, 1, 0, \"th\", 6);\n      i0.ɵɵtemplate(23, ProjectUsersComponent_td_23_Template, 5, 3, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵtemplate(24, ProjectUsersComponent_tr_24_Template, 1, 0, \"tr\", 13);\n      i0.ɵɵtemplate(25, ProjectUsersComponent_tr_25_Template, 1, 0, \"tr\", 14);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ctx.chooseUserActive);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"dataSource\", ctx.dataSource);\n      i0.ɵɵadvance(19);\n      i0.ɵɵproperty(\"matHeaderRowDef\", ctx.displayedColumns);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"matRowDefColumns\", ctx.displayedColumns);\n    }\n  },\n  dependencies: [i6.NgForOf, i6.NgIf, i7.RouterLink, i8.MatFormField, i8.MatLabel, i9.MatSelect, i10.MatOption, i11.MatButton, i12.MatTable, i12.MatHeaderCellDef, i12.MatHeaderRowDef, i12.MatColumnDef, i12.MatCellDef, i12.MatRowDef, i12.MatHeaderCell, i12.MatCell, i12.MatHeaderRow, i12.MatRow, i13.ɵNgNoValidate, i13.NgControlStatus, i13.NgControlStatusGroup, i13.FormGroupDirective, i13.FormControlName, i14.MatDivider, i6.AsyncPipe],\n  styles: [\".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;height:100vh;width:100%;margin-top:20px;padding:10px;background-color:#f17d7d;border-radius:5px;box-shadow:0 0 5px #0003}.container[_ngcontent-%COMP%]   .choseUser[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}.container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:10px}\"]\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}