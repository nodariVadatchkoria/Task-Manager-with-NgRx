{"ast":null,"code":"import { TaskAddEditComponent } from \"../../../shared/task-add-edit/task-add-edit.component\";\nimport * as _ from 'lodash';\nimport { moveItemInArray, transferArrayItem } from \"@angular/cdk/drag-drop\";\nimport { ConfirmDeleteComponent } from \"../../../shared/confirm-delete/confirm-delete.component\";\nimport { of, Subject, switchMap, takeUntil } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../../core/services/board.service\";\nimport * as i3 from \"../../../core/services/project.service\";\nimport * as i4 from \"../../../core/services/task.service\";\nimport * as i5 from \"@angular/material/dialog\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/cdk/drag-drop\";\nfunction BoardComponent_div_4_div_5_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 17);\n  }\n}\nfunction BoardComponent_div_4_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵtemplate(1, BoardComponent_div_4_div_5_div_1_Template, 1, 0, \"div\", 13);\n    i0.ɵɵelementStart(2, \"h4\", 14);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 15);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function BoardComponent_div_4_div_5_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const task_r3 = restoredCtx.$implicit;\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.deleteTask(task_r3.id));\n    });\n    i0.ɵɵtext(7, \"delete\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const task_r3 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(task_r3.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(task_r3.description);\n  }\n}\nconst _c0 = function () {\n  return [];\n};\nfunction BoardComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵlistener(\"cdkDropListDropped\", function BoardComponent_div_4_Template_div_cdkDropListDropped_0_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const column_r1 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.drop($event, column_r1));\n    });\n    i0.ɵɵelementStart(1, \"div\", 5)(2, \"div\", 6)(3, \"p\", 7);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(5, BoardComponent_div_4_div_5_Template, 8, 2, \"div\", 8);\n    i0.ɵɵelementStart(6, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function BoardComponent_div_4_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const column_r1 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.addTask(column_r1));\n    });\n    i0.ɵɵelementStart(7, \"span\", 10);\n    i0.ɵɵtext(8, \"add\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\", 11);\n    i0.ɵɵtext(10, \"Add Task\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const column_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"cdkDropListData\", ctx_r0.tasks[column_r1.id] || i0.ɵɵpureFunction0(3, _c0));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(column_r1.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.tasks[column_r1.id] || i0.ɵɵpureFunction0(4, _c0));\n  }\n}\nexport class BoardComponent {\n  constructor(route, boardService, projectService, taskService, dialog) {\n    this.route = route;\n    this.boardService = boardService;\n    this.projectService = projectService;\n    this.taskService = taskService;\n    this.dialog = dialog;\n    this.sub$ = new Subject();\n    this.board = {};\n    this.tasks = {};\n    this.projectName = this.projectService.projectName;\n  }\n  ngOnInit() {\n    this.route.params.subscribe(params => {\n      console.log(params);\n      if (params) {\n        this.boardId = +params['id'];\n        this.boardService.getBoardByID(params['id'], params['projectId']).subscribe(res => {\n          this.board = res;\n          console.log(this.board);\n        });\n        console.log(params['id']);\n      }\n    });\n  }\n  ngAfterViewInit() {\n    this.getTasks();\n  }\n  // fetchTasks() {\n  //   this.taskService.getTasks({boardId: this.boardId})\n  //     .subscribe(tasks => {\n  //       this.tasks = tasks;\n  //     })\n  // }\n  addTask(column) {\n    const dialogRef = this.dialog.open(TaskAddEditComponent, {\n      width: '600px',\n      data: {\n        boardId: this.boardId,\n        column: column\n      }\n    });\n    dialogRef.afterClosed().subscribe(task => {\n      if (task) {\n        this.getTasks();\n      }\n    });\n  }\n  getTasks() {\n    this.taskService.getTasks({\n      boardId: this.boardId\n    }).subscribe(tasks => {\n      this.tasks = _.groupBy(tasks, 'boardColumnId');\n      console.log(tasks);\n    });\n  }\n  drop(event, column) {\n    console.log(event.container);\n    if (event.previousContainer === event.container) {\n      moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);\n    } else {\n      transferArrayItem(event.previousContainer.data, event.container.data, event.previousIndex, event.currentIndex);\n      const tasks = event.container.data.map((task, index) => {\n        return {\n          ...task,\n          taskStatus: column.taskStatus,\n          boardColumnId: column.id\n        };\n      });\n      this.tasks[column.id] = tasks;\n      const currentTask = tasks[event.currentIndex];\n      console.log(currentTask);\n      this.taskService.updateTask(currentTask.id, currentTask).subscribe(task => {\n        console.log(task);\n        this.getTasks();\n      });\n    }\n  }\n  deleteTask(id) {\n    const dialogRef = this.dialog.open(ConfirmDeleteComponent);\n    dialogRef.afterClosed().pipe(takeUntil(this.sub$), switchMap(result => {\n      if (result) {\n        return this.taskService.deleteTask(id);\n      }\n      return of(null);\n    })).subscribe(result => {\n      if (result) {\n        this.getTasks();\n      }\n    });\n  }\n  ngOnDestroy() {\n    this.sub$.next(null);\n    this.sub$.complete();\n  }\n}\nBoardComponent.ɵfac = function BoardComponent_Factory(t) {\n  return new (t || BoardComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.BoardService), i0.ɵɵdirectiveInject(i3.ProjectService), i0.ɵɵdirectiveInject(i4.TaskService), i0.ɵɵdirectiveInject(i5.MatDialog));\n};\nBoardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: BoardComponent,\n  selectors: [[\"app-board\"]],\n  decls: 5,\n  vars: 2,\n  consts: [[1, \"head\"], [1, \"name\"], [\"cdkDropListGroup\", \"\", 1, \"display\"], [\"class\", \"column-container\", \"cdkDropList\", \"\", 3, \"cdkDropListData\", \"cdkDropListDropped\", 4, \"ngFor\", \"ngForOf\"], [\"cdkDropList\", \"\", 1, \"column-container\", 3, \"cdkDropListData\", \"cdkDropListDropped\"], [1, \"column\"], [1, \"col-header\"], [1, \"col-name\"], [\"class\", \"task\", \"cdkDrag\", \"\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"add-task\", 3, \"click\"], [1, \"material-icons\"], [1, \"p-add\"], [\"cdkDrag\", \"\", 1, \"task\"], [\"class\", \"placeholder\", 4, \"cdkDragPlaceholder\"], [1, \"title\"], [1, \"desc\"], [1, \"material-icons\", \"btn-delete\", 3, \"click\"], [1, \"placeholder\"]],\n  template: function BoardComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"p\", 1);\n      i0.ɵɵtext(2);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(3, \"div\", 2);\n      i0.ɵɵtemplate(4, BoardComponent_div_4_Template, 11, 5, \"div\", 3);\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate(ctx.projectName);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.board.columns);\n    }\n  },\n  dependencies: [i6.NgForOf, i7.CdkDropListGroup, i7.CdkDropList, i7.CdkDrag],\n  styles: [\".head[_ngcontent-%COMP%]{width:100%;height:67px;background-color:#e9ecef;position:absolute;top:0;left:0;z-index:-1}.name[_ngcontent-%COMP%]{font-size:1.4rem;color:#676060;margin-left:10%;margin-top:20px}.col-name[_ngcontent-%COMP%]{margin-top:10px}.col-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-left:10px;margin-right:10px}.prog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:150px;margin-left:10px;margin-right:10px}.column[_ngcontent-%COMP%]{width:300px;min-height:100px;background-color:#e9ecef;border-radius:3px}.dots[_ngcontent-%COMP%]{color:#a39696;margin-top:10px;width:30px;height:30px;justify-content:center;align-content:center;align-items:center}.dots-container[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%;display:flex}.dots-container[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#dee2e6}.add-task[_ngcontent-%COMP%]{width:35%;height:35px;display:flex;gap:5px;margin:30px 10px 10px;align-content:center;border-radius:5px;justify-content:center;align-items:center;border:none}.p-add[_ngcontent-%COMP%]{margin-top:10px}.desc[_ngcontent-%COMP%]{margin-left:5px;margin-right:5px}.add-task[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#dee2e6}.task[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;border-radius:5px;width:280px;min-height:40px;background-color:#fff;margin-bottom:10px;cursor:pointer;padding:5px 5px 3px}.task[_ngcontent-%COMP%]:active{cursor:grabbing}.title[_ngcontent-%COMP%], .desc[_ngcontent-%COMP%]{margin-left:8px}.title[_ngcontent-%COMP%]{margin-bottom:0}.display[_ngcontent-%COMP%]{margin-top:150px;margin-bottom:20%;margin-left:150px;display:flex;gap:15px}.placeholder[_ngcontent-%COMP%]{background:#ccc;border:dotted 3px #999;min-height:60px;transition:transform .25s cubic-bezier(0,0,.2,1)}.btn-delete[_ngcontent-%COMP%]{color:red;margin-left:90%;display:none;margin-top:-25px;border:none;background:none;cursor:pointer}.task[_ngcontent-%COMP%]:hover   .btn-delete[_ngcontent-%COMP%]{display:block}.btn-delete[_ngcontent-%COMP%]:hover{color:#c9131aa1}\"]\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}