{"ast":null,"code":"import * as _ from 'lodash';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../core/services/role.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nfunction PermissionAddEditComponent_div_1_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 7);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 8)(4, \"input\", 9);\n    i0.ɵɵlistener(\"change\", function PermissionAddEditComponent_div_1_div_3_Template_input_change_4_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const permission_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.checkPermission(permission_r3));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const permission_r3 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(permission_r3.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"checked\", ctx_r2.permissions.has(permission_r3.id));\n  }\n}\nfunction PermissionAddEditComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\", 4);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, PermissionAddEditComponent_div_1_div_3_Template, 5, 2, \"div\", 5);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const group_r1 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(group_r1.key);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", group_r1.permissions);\n  }\n}\nexport class PermissionAddEditComponent {\n  constructor(roleService, route) {\n    this.roleService = roleService;\n    this.route = route;\n    this.groups = [];\n    this.permissions = new Set();\n  }\n  ngOnInit() {\n    this.route.params.subscribe(params => {\n      if (params['roleId']) {\n        this.roleId = params['roleId'];\n        this.getPermissionsByRole();\n      }\n    });\n    this.getPermissions();\n  }\n  getPermissionsByRole() {\n    this.roleService.getRole(this.roleId).subscribe(role => {\n      console.log(role);\n      role && role.permissions && role.permissions.length && role.permissions.forEach(p => this.permissions.add(p.id));\n    });\n  }\n  getPermissions() {\n    this.roleService.getPermissions().subscribe(permissions => {\n      console.log(permissions);\n      const grouped = _.groupBy(permissions, 'groupKey');\n      this.groups = Object.keys(grouped).map(key => {\n        return {\n          key,\n          permissions: grouped[key]\n        };\n      });\n      console.log(this.groups);\n    });\n  }\n  checkPermission(permission) {\n    this.permissions.has(permission.id) ? this.permissions.delete(permission.id) : this.permissions.add(permission.id);\n  }\n  save() {\n    this.roleService.setPermissions({\n      roleId: this.roleId,\n      permissions: Array.from(this.permissions)\n    }).subscribe(res => {\n      console.log(res);\n    });\n  }\n}\nPermissionAddEditComponent.ɵfac = function PermissionAddEditComponent_Factory(t) {\n  return new (t || PermissionAddEditComponent)(i0.ɵɵdirectiveInject(i1.RoleService), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n};\nPermissionAddEditComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: PermissionAddEditComponent,\n  selectors: [[\"app-permission-add-edit\"]],\n  decls: 4,\n  vars: 1,\n  consts: [[1, \"container\"], [\"class\", \"group\", 4, \"ngFor\", \"ngForOf\"], [3, \"click\"], [1, \"group\"], [1, \"group-name\"], [\"class\", \"permission\", 4, \"ngFor\", \"ngForOf\"], [1, \"permission\"], [1, \"permission-name\"], [1, \"permission-value\"], [\"type\", \"checkbox\", 3, \"checked\", \"change\"]],\n  template: function PermissionAddEditComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵtemplate(1, PermissionAddEditComponent_div_1_Template, 4, 2, \"div\", 1);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"button\", 2);\n      i0.ɵɵlistener(\"click\", function PermissionAddEditComponent_Template_button_click_2_listener() {\n        return ctx.save();\n      });\n      i0.ɵɵtext(3, \"Save\");\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngForOf\", ctx.groups);\n    }\n  },\n  dependencies: [i3.NgForOf],\n  styles: [\".container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:20px}.container[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{border:1px solid #ccc;padding:10px}.container[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]   .permission[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}\"]\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}