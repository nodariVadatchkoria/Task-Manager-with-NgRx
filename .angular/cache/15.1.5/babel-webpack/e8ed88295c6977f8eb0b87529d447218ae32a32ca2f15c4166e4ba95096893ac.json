{"ast":null,"code":"import { MatTableDataSource } from \"@angular/material/table\";\nimport { Subject, takeUntil } from \"rxjs\";\nimport { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { UserEditComponent } from \"./user/user-add-edit/user-edit.component\";\nimport { currentProject } from \"../../../../store/rxProject/project.selectors\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"../../../../core/services/project.service\";\nimport * as i3 from \"../../../../facades/users-facade.service\";\nimport * as i4 from \"../../../../core/services/users.service\";\nimport * as i5 from \"@angular/material/dialog\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/router\";\nimport * as i8 from \"@angular/material/form-field\";\nimport * as i9 from \"@angular/material/select\";\nimport * as i10 from \"@angular/material/core\";\nimport * as i11 from \"@angular/material/button\";\nimport * as i12 from \"@angular/material/table\";\nimport * as i13 from \"@angular/forms\";\nimport * as i14 from \"@angular/material/divider\";\nfunction ProjectUsersComponent_div_4_mat_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-option\", 19);\n    i0.ɵɵlistener(\"click\", function ProjectUsersComponent_div_4_mat_option_6_Template_mat_option_click_0_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r17.onSubmit());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const user_r16 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", user_r16.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", user_r16.firstName, \"\", user_r16.lastName, \" \");\n  }\n}\nfunction ProjectUsersComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"form\", 15)(2, \"mat-form-field\")(3, \"mat-label\");\n    i0.ɵɵtext(4, \"Chose User\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"mat-select\", 16);\n    i0.ɵɵtemplate(6, ProjectUsersComponent_div_4_mat_option_6_Template, 2, 3, \"mat-option\", 17);\n    i0.ɵɵpipe(7, \"async\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(8, \"mat-divider\");\n    i0.ɵɵelementStart(9, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ProjectUsersComponent_div_4_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.addNewUser());\n    });\n    i0.ɵɵtext(10, \"Add New User \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.userForm);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(7, 2, ctx_r0.users$));\n  }\n}\nfunction ProjectUsersComponent_th_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Id\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r21 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r21.id, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \"First Name\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r22 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r22.firstName, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \" Last Name\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r23 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r23.lastName, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \"Email\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r24 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r24.email, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 20);\n    i0.ɵɵtext(1, \"Is Active\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectUsersComponent_td_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r25 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r25.isActive, \" \");\n  }\n}\nfunction ProjectUsersComponent_th_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"th\", 20);\n  }\n}\nconst _c0 = function (a1) {\n  return [\"/application/setting/users/edit/\", a1];\n};\nfunction ProjectUsersComponent_td_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r28 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\", 21)(1, \"button\", 22);\n    i0.ɵɵtext(2, \"Edit \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ProjectUsersComponent_td_23_Template_button_click_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r28);\n      const element_r26 = restoredCtx.$implicit;\n      const ctx_r27 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r27.removeUser(element_r26.id));\n    });\n    i0.ɵɵtext(4, \"Remove \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const element_r26 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(1, _c0, element_r26.id));\n  }\n}\nfunction ProjectUsersComponent_tr_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 24);\n  }\n}\nfunction ProjectUsersComponent_tr_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 25);\n  }\n}\nexport class ProjectUsersComponent {\n  get projectId() {\n    // return this.projectFacade.getProject().id\n    return this.store.select(currentProject).subscribe(project => {\n      if (project) {\n        return project.id;\n      } else {\n        return null;\n      }\n    });\n  }\n  constructor(store, projectService,\n  // private projectFacade: ProjectFacade,\n  userFacade, userService, dialog) {\n    this.store = store;\n    this.projectService = projectService;\n    this.userFacade = userFacade;\n    this.userService = userService;\n    this.dialog = dialog;\n    this.displayedColumns = ['id', 'firstName', 'lastName', 'email', 'isActive', 'actions'];\n    this.dataSource = new MatTableDataSource();\n    this.sub$ = new Subject();\n    this.chooseUserActive = false;\n    this.users$ = this.userService.getUsersAll();\n    this.projectUsersIds = [];\n    this.userForm = new FormGroup({\n      userId: new FormControl(null, [Validators.required])\n    });\n  }\n  getCurrentProjectUsers() {\n    this.projectService.getProjectUsersId(+this.projectId).pipe(takeUntil(this.sub$)).subscribe(users => {\n      this.projectUsersIds = users.map(user => user.id);\n      this.dataSource.data = users;\n    });\n  }\n  ngOnInit() {\n    // this.getCurrentProjectUsers()\n    this.store.select(currentProject).subscribe(project => {\n      if (project) {\n        this.getCurrentProjectUsers();\n      }\n    });\n  }\n  ngOnDestroy() {\n    this.sub$.next(null);\n    this.sub$.complete();\n  }\n  removeUser(id) {\n    const userIds = this.projectUsersIds.filter(userId => userId !== id);\n    this.projectService.addProjectUserData({\n      projectId: +this.projectId,\n      userIds\n    }).pipe(takeUntil(this.sub$)).subscribe(() => {\n      this.getCurrentProjectUsers();\n    });\n  }\n  addUser() {\n    this.chooseUserActive = !this.chooseUserActive;\n  }\n  onSubmit() {\n    const userIds = [...this.projectUsersIds, this.userForm.value.userId];\n    this.createUser(userIds).subscribe(() => {\n      this.getCurrentProjectUsers();\n      this.addUser();\n    });\n  }\n  createUser(userIds) {\n    return this.projectService.addProjectUserData({\n      projectId: +this.projectId,\n      userIds\n    }).pipe(takeUntil(this.sub$));\n  }\n  addNewUser() {\n    const dialog = this.dialog.open(UserEditComponent);\n    dialog.afterClosed().pipe(takeUntil(this.sub$)).subscribe(result => {\n      if (result) {\n        const userIds = [...this.projectUsersIds, result.id];\n        this.createUser(userIds).subscribe(() => {\n          this.getCurrentProjectUsers();\n          this.chooseUserActive = false;\n        });\n      }\n    });\n  }\n}\nProjectUsersComponent.ɵfac = function ProjectUsersComponent_Factory(t) {\n  return new (t || ProjectUsersComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.ProjectService), i0.ɵɵdirectiveInject(i3.UsersFacadeService), i0.ɵɵdirectiveInject(i4.UsersService), i0.ɵɵdirectiveInject(i5.MatDialog));\n};\nProjectUsersComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProjectUsersComponent,\n  selectors: [[\"app-project-users\"]],\n  decls: 26,\n  vars: 4,\n  consts: [[1, \"container\"], [1, \"choseUser\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [4, \"ngIf\"], [\"mat-table\", \"\", 1, \"mat-elevation-z8\", 3, \"dataSource\"], [\"matColumnDef\", \"id\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [\"matColumnDef\", \"firstName\"], [\"matColumnDef\", \"lastName\"], [\"matColumnDef\", \"email\"], [\"matColumnDef\", \"isActive\"], [\"matColumnDef\", \"actions\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [3, \"formGroup\"], [\"formControlName\", \"userId\"], [3, \"value\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 3, \"click\"], [3, \"value\", \"click\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"routerLink\"], [\"mat-raised-button\", \"\", \"color\", \"warn\", 3, \"click\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"]],\n  template: function ProjectUsersComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"button\", 2);\n      i0.ɵɵlistener(\"click\", function ProjectUsersComponent_Template_button_click_2_listener() {\n        return ctx.addUser();\n      });\n      i0.ɵɵtext(3, \"Choose User \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(4, ProjectUsersComponent_div_4_Template, 11, 4, \"div\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"table\", 4);\n      i0.ɵɵelementContainerStart(6, 5);\n      i0.ɵɵtemplate(7, ProjectUsersComponent_th_7_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(8, ProjectUsersComponent_td_8_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(9, 8);\n      i0.ɵɵtemplate(10, ProjectUsersComponent_th_10_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(11, ProjectUsersComponent_td_11_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(12, 9);\n      i0.ɵɵtemplate(13, ProjectUsersComponent_th_13_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(14, ProjectUsersComponent_td_14_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(15, 10);\n      i0.ɵɵtemplate(16, ProjectUsersComponent_th_16_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(17, ProjectUsersComponent_td_17_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(18, 11);\n      i0.ɵɵtemplate(19, ProjectUsersComponent_th_19_Template, 2, 0, \"th\", 6);\n      i0.ɵɵtemplate(20, ProjectUsersComponent_td_20_Template, 2, 1, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementContainerStart(21, 12);\n      i0.ɵɵtemplate(22, ProjectUsersComponent_th_22_Template, 1, 0, \"th\", 6);\n      i0.ɵɵtemplate(23, ProjectUsersComponent_td_23_Template, 5, 3, \"td\", 7);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵtemplate(24, ProjectUsersComponent_tr_24_Template, 1, 0, \"tr\", 13);\n      i0.ɵɵtemplate(25, ProjectUsersComponent_tr_25_Template, 1, 0, \"tr\", 14);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ctx.chooseUserActive);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"dataSource\", ctx.dataSource);\n      i0.ɵɵadvance(19);\n      i0.ɵɵproperty(\"matHeaderRowDef\", ctx.displayedColumns);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"matRowDefColumns\", ctx.displayedColumns);\n    }\n  },\n  dependencies: [i6.NgForOf, i6.NgIf, i7.RouterLink, i8.MatFormField, i8.MatLabel, i9.MatSelect, i10.MatOption, i11.MatButton, i12.MatTable, i12.MatHeaderCellDef, i12.MatHeaderRowDef, i12.MatColumnDef, i12.MatCellDef, i12.MatRowDef, i12.MatHeaderCell, i12.MatCell, i12.MatHeaderRow, i12.MatRow, i13.ɵNgNoValidate, i13.NgControlStatus, i13.NgControlStatusGroup, i13.FormGroupDirective, i13.FormControlName, i14.MatDivider, i6.AsyncPipe],\n  styles: [\".container[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 10px;\\n  height: 100vh;\\n  width: 100%;\\n  margin-top: 20px;\\n  padding: 10px;\\n  background-color: #f17d7d;\\n  border-radius: 5px;\\n  box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.2);\\n}\\n\\n.container[_ngcontent-%COMP%]   .choseUser[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: row;\\n  gap: 10px;\\n}\\n\\n.container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\\n  margin-left: 10px;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvcGFnZXMvYXBwbGljYXRpb24vcHJvamVjdC1zZXR0aW5nL3Byb2plY3QtdXNlcnMvcHJvamVjdC11c2Vycy5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGFBQUE7RUFDQSxzQkFBQTtFQUNBLFNBQUE7RUFDQSxhQUFBO0VBQ0EsV0FBQTtFQUNBLGdCQUFBO0VBQ0EsYUFBQTtFQUNBLHlCQUFBO0VBQ0Esa0JBQUE7RUFDQSx3Q0FBQTtBQUNGOztBQUFFO0VBQ0UsYUFBQTtFQUNBLG1CQUFBO0VBQ0EsU0FBQTtBQUVKOztBQUFFO0VBQ0UsaUJBQUE7QUFFSiIsInNvdXJjZXNDb250ZW50IjpbIi5jb250YWluZXJ7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIGdhcDogMTBweDtcbiAgaGVpZ2h0OiAxMDB2aDtcbiAgd2lkdGg6IDEwMCU7XG4gIG1hcmdpbi10b3A6IDIwcHg7XG4gIHBhZGRpbmc6IDEwcHg7XG4gIGJhY2tncm91bmQtY29sb3I6ICNmMTdkN2Q7XG4gIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgYm94LXNoYWRvdzogMCAwIDVweCAwIHJnYmEoMCwwLDAsMC4yKTtcbiAgLmNob3NlVXNlcntcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGZsZXgtZGlyZWN0aW9uOiByb3c7XG4gICAgZ2FwOiAxMHB4O1xuICB9XG4gIGJ1dHRvbntcbiAgICBtYXJnaW4tbGVmdDogMTBweDtcbiAgfVxuXG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"mappings":"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","names":["MatTableDataSource","Subject","takeUntil","FormControl","FormGroup","Validators","UserEditComponent","currentProject","i0","ProjectUsersComponent","projectId","store","select","subscribe","project","id","constructor","projectService","userFacade","userService","dialog","getUsersAll","userId","required","getCurrentProjectUsers","getProjectUsersId","pipe","sub$","users","projectUsersIds","map","user","dataSource","data","ngOnInit","ngOnDestroy","next","complete","removeUser","userIds","filter","addProjectUserData","addUser","chooseUserActive","onSubmit","userForm","value","createUser","addNewUser","open","afterClosed","result","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["/Users/macbookpro/Desktop/GitHubRepo/Task-Manager-with-NgRx/src/app/pages/application/project-setting/project-users/project-users.component.ts","/Users/macbookpro/Desktop/GitHubRepo/Task-Manager-with-NgRx/src/app/pages/application/project-setting/project-users/project-users.component.html"],"sourcesContent":["import {Component, OnDestroy, OnInit} from '@angular/core';\nimport {MatTableDataSource} from \"@angular/material/table\";\nimport {IBoard, User} from \"../../../../core/interfaces\";\nimport {Observable, Subject, takeUntil} from \"rxjs\";\nimport {ProjectService} from \"../../../../core/services/project.service\";\nimport {ProjectFacade} from \"../../../../facades/project-facade.service\";\nimport {UsersFacadeService} from \"../../../../facades/users-facade.service\";\nimport {FormControl, FormGroup, Validators} from \"@angular/forms\";\nimport {UsersService} from \"../../../../core/services/users.service\";\nimport {MatDialog} from \"@angular/material/dialog\";\nimport {UserEditComponent} from \"./user/user-add-edit/user-edit.component\";\nimport {Store} from \"@ngrx/store\";\nimport {ProjectStateModule} from \"../../../../store\";\nimport {currentProject} from \"../../../../store/rxProject/project.selectors\";\n\n@Component({\n    selector: 'app-project-users',\n    templateUrl: './project-users.component.html',\n    styleUrls: ['./project-users.component.scss']\n})\nexport class ProjectUsersComponent implements OnInit, OnDestroy {\n\n    displayedColumns = ['id', 'firstName', 'lastName', 'email', 'isActive', 'actions']\n    dataSource = new MatTableDataSource<IBoard>();\n    sub$ = new Subject();\n    chooseUserActive = false;\n    users$: Observable<User[]> = this.userService.getUsersAll()\n    projectUsersIds: number[] = [];\n\n    get projectId(){\n        // return this.projectFacade.getProject().id\n        return this.store.select(currentProject).subscribe((project)=>{\n            if (project){\n                return project.id\n            }\n            else{\n                return null\n            }\n        })\n    }\n\n    constructor(\n        private store: Store<{ project: ProjectStateModule }>,\n        private projectService: ProjectService,\n        // private projectFacade: ProjectFacade,\n        private userFacade: UsersFacadeService,\n        private userService: UsersService,\n        private dialog: MatDialog,\n    ) {\n    }\n\n    userForm: FormGroup = new FormGroup({\n        userId: new FormControl(null, [Validators.required]),\n    });\n\n    getCurrentProjectUsers() {\n        this.projectService.getProjectUsersId(+this.projectId)\n            .pipe(takeUntil(this.sub$))\n            .subscribe(users => {\n                this.projectUsersIds = users.map((user: User) => user.id)\n                this.dataSource.data = users\n            })\n    }\n\n\n    ngOnInit(): void {\n        // this.getCurrentProjectUsers()\n        this.store.select(currentProject)\n            .subscribe((project)=>{\n                if (project){\n                    this.getCurrentProjectUsers();\n                }\n            })\n    }\n\n    ngOnDestroy(): void {\n        this.sub$.next(null);\n        this.sub$.complete();\n    }\n\n    removeUser(id: number) {\n        const userIds = this.projectUsersIds.filter((userId: number) => userId !== id)\n        this.projectService.addProjectUserData({\n            projectId: +this.projectId,\n            userIds\n        })\n            .pipe(takeUntil(this.sub$))\n            .subscribe(() => {\n                this.getCurrentProjectUsers()\n            })\n    }\n\n\n    addUser() {\n        this.chooseUserActive = !this.chooseUserActive;\n\n    }\n\n    onSubmit() {\n        const userIds = [...this.projectUsersIds, this.userForm.value.userId]\n        this.createUser(userIds)\n            .subscribe(() => {\n                this.getCurrentProjectUsers()\n                this.addUser()\n\n            })\n    }\n\n    createUser(userIds: number[]) {\n        return this.projectService.addProjectUserData({\n            projectId: +this.projectId,\n            userIds\n        })\n            .pipe(takeUntil(this.sub$))\n\n    }\n\n    addNewUser() {\n        const dialog = this.dialog.open(UserEditComponent)\n        dialog.afterClosed()\n            .pipe(takeUntil(this.sub$))\n            .subscribe((result: User) => {\n\n                if (result) {\n                    const userIds = [...this.projectUsersIds, result.id]\n                    this.createUser(userIds)\n                        .subscribe(() => {\n                            this.getCurrentProjectUsers()\n                            this.chooseUserActive = false;\n                        })\n                }\n\n            })\n    }\n}\n","<div class=\"container\">\n  <div class=\"choseUser\"> <button mat-raised-button color=\"primary\"\n                (click)=\"addUser()\">Choose User\n  </button>\n    <div *ngIf=\"chooseUserActive\">\n      <form [formGroup]=\"userForm\" >\n        <mat-form-field >\n          <mat-label>Chose User</mat-label>\n          <mat-select formControlName=\"userId\">\n            <mat-option *ngFor=\"let user of users$ | async\" [value]=\"user.id\" (click)=\"onSubmit()\">\n              {{user.firstName}}{{user.lastName}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n        <mat-divider></mat-divider>\n        <button mat-raised-button color=\"primary\"\n                type=\"submit\" (click)=\"addNewUser()\">Add New User\n        </button>\n      </form>\n\n    </div>\n  </div>\n\n  <table mat-table [dataSource]=\"dataSource\" class=\"mat-elevation-z8\">\n\n    <!-- Position Column -->\n    <ng-container matColumnDef=\"id\">\n      <th mat-header-cell *matHeaderCellDef> Id</th>\n      <td mat-cell *matCellDef=\"let element\"> {{element.id}} </td>\n    </ng-container>\n\n    <!-- Name Column -->\n    <ng-container matColumnDef=\"firstName\">\n      <th mat-header-cell *matHeaderCellDef>First Name</th>\n      <td mat-cell *matCellDef=\"let element\"> {{element.firstName}} </td>\n    </ng-container>\n\n    <!-- Weight Column -->\n    <ng-container matColumnDef=\"lastName\">\n      <th mat-header-cell *matHeaderCellDef> Last Name</th>\n      <td mat-cell *matCellDef=\"let element\"> {{element.lastName}} </td>\n    </ng-container>\n    <ng-container matColumnDef=\"email\">\n      <th mat-header-cell *matHeaderCellDef>Email</th>\n      <td mat-cell *matCellDef=\"let element\"> {{element.email}} </td>\n    </ng-container>\n    <ng-container matColumnDef=\"isActive\">\n      <th mat-header-cell *matHeaderCellDef>Is Active</th>\n      <td mat-cell *matCellDef=\"let element\"> {{element.isActive}} </td>\n    </ng-container>\n\n    <ng-container matColumnDef=\"actions\">\n      <th mat-header-cell *matHeaderCellDef></th>\n      <td mat-cell *matCellDef=\"let element\">\n        <button mat-raised-button color=\"primary\"\n                [routerLink]=\"['/application/setting/users/edit/', element.id]\">Edit\n        </button>\n        <button mat-raised-button color=\"warn\"\n                (click)=\"removeUser(element.id)\">Remove\n        </button>\n\n      </td>\n    </ng-container>\n\n    <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n    <tr mat-row *matRowDef=\"let row; columns: displayedColumns;\"></tr>\n  </table>\n\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}